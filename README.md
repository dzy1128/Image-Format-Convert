# ComfyUI 图片格式转换节点

这是一个为ComfyUI设计的图片格式转换自定义节点包，可以将输入的图片转换为不同的格式。

## 功能特性

- 🖼️ **批量处理**：支持单张或多张图片同时转换
- 🔄 **多格式支持**：支持PNG、JPEG、WEBP、BMP、TIFF等常见格式
- 📐 **尺寸保持**：转换过程中保持原始图片尺寸不变
- ⚙️ **质量控制**：对于JPEG和WEBP格式，可以调整图片质量
- 📊 **格式信息**：提供图片格式信息查看功能

## 包含的节点

### 1. ImageFormatConverter (图片格式转换器)

**功能**：将输入图片转换为指定格式

**输入参数**：
- `images`：输入的图片（支持批量处理）
- `output_format`：目标格式（PNG/JPEG/WEBP/BMP/TIFF）
- `quality`：图片质量（1-100，主要用于JPEG和WEBP格式）

**输出**：
- `converted_images`：转换后的图片

**特殊处理**：
- JPEG和BMP格式不支持透明度，会自动添加白色背景
- PNG和WEBP格式保持透明度支持
- 自动处理色彩空间转换

### 2. ImageFormatInfo (图片格式信息)

**功能**：显示输入图片的详细格式信息

**输入参数**：
- `images`：要查看信息的图片

**输出**：
- `format_info`：图片格式信息字符串

## 安装方法

1. 将此文件夹复制到ComfyUI的`custom_nodes`目录下：
   ```
   ComfyUI/custom_nodes/Image-Format-Convert/
   ```

2. 重启ComfyUI

3. 在节点菜单中查找"image/format"分类下的节点

## 使用示例

### 基本格式转换流程

1. **加载图片** → **ImageFormatConverter** → **保存图片**
   - 在ImageFormatConverter节点中选择目标格式
   - 对于JPEG/WEBP，可以调整质量参数
   - 输出的图片将采用新的格式

2. **查看图片信息**：
   - 连接ImageFormatInfo节点查看图片的详细格式信息
   - 信息会显示在控制台和节点输出中

### 批量转换

节点自动支持批量处理，如果输入多张图片，会同时转换所有图片并保持批量结构。

## 技术细节

- **张量格式**：兼容ComfyUI标准的图片张量格式（H×W×C，值域0-1）
- **内存优化**：使用流式处理，避免大量图片时的内存问题
- **格式兼容**：智能处理不同颜色空间和透明度的转换
- **质量保证**：转换过程中保持图片质量，支持质量参数调节

## 支持的格式

| 格式 | 透明度支持 | 质量调节 | 说明 |
|------|------------|----------|------|
| PNG  | ✅         | ❌       | 无损压缩，支持透明度 |
| JPEG | ❌         | ✅       | 有损压缩，适合照片 |
| WEBP | ✅         | ✅       | 现代格式，压缩效率高 |
| BMP  | ❌         | ❌       | 无压缩，文件较大 |
| TIFF | ✅         | ❌       | 专业格式，支持多种色彩空间 |

## 注意事项

- 转换为不支持透明度的格式时，透明区域会被填充为白色
- JPEG格式会自动转换为RGB色彩空间
- 质量参数仅对JPEG和WEBP格式有效
- 建议在转换前使用ImageFormatInfo节点查看原始图片信息

## 更新日志

### v1.0.0
- 初始版本发布
- 支持5种常见图片格式转换
- 实现批量处理功能
- 添加图片格式信息查看功能
